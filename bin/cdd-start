#!/bin/bash
if [[ "$1" == "--help" ]]; then
    echo "COMMAND: cdd-start <track-name>"
    echo "OBJECTIVE: Create an isolated workspace (Track)."
    echo "RATIONALE: Isolates context so multiple agents/tasks don't collide."
    exit 0
fi

TRACK_NAME=$1
if [ -z "$TRACK_NAME" ]; then echo "Error: Missing track name."; exit 1; fi
TRACK_DIR=".context/tracks/$TRACK_NAME"

if [ -d "$TRACK_DIR" ]; then echo "Error: Track exists."; exit 1; fi

mkdir -p "$TRACK_DIR"

# Generate Structured Spec Template
cat << SPEC > "$TRACK_DIR/spec.md"
# Specification: $TRACK_NAME

## 1. User Intent (The Goal)
> [User Input Required]

## 2. Relevant Context (The Files)
> [Agent to Populate during Analysis]
> List the specific files involved in this track.
> This acts as the "Working Set" to reduce search tokens later.
- \`path/to/relevant/file.ext\`

## 3. Context Analysis (Agent Findings)
> [Agent to Populate]
> - Current Behavior:
> - Proposed Changes:

## 4. Scenarios (Acceptance Criteria)
> [Agent to Draft based on Intent]
- [ ] Scenario A
- [ ] Scenario B
SPEC

cat << PLAN > "$TRACK_DIR/plan.md"
# Plan for $TRACK_NAME

- [ ] ðŸ—£ï¸ Phase 0: Alignment & Analysis (Fill spec.md)
- [ ] ðŸ“ Phase 1: Approval (User signs off)
PLAN

echo "# Decision Log\n> Created $(date)" > "$TRACK_DIR/decisions.md"
echo "# Scratchpad for $TRACK_NAME\n> Dump raw logs here." > "$TRACK_DIR/scratchpad.md"

echo "Track '$TRACK_NAME' initialized."
